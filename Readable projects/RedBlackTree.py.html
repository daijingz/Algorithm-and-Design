<html>
<head>
<title>RedBlackTree.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
RedBlackTree.py</font>
</center></td></tr></table>
<pre><span class="s0"># Author: Jingze Dai</span>
<span class="s0"># Email Address: daij24@mcmaster.ca or david1147062956@163.com</span>
<span class="s0"># Github: https://github.com/daijingz</span>
<span class="s0"># Linkedin: https://www.linkedin.com/in/jingze-dai/</span>
<span class="s0"># Description: Red Black Tree</span>
<span class="s2">import </span><span class="s1">sys</span>


<span class="s0"># Node creation</span>
<span class="s2">class </span><span class="s1">Node():</span>
    <span class="s2">def </span><span class="s1">__init__(self</span><span class="s2">, </span><span class="s1">item):</span>
        <span class="s1">self.item = item</span>
        <span class="s1">self.parent = </span><span class="s2">None</span>
        <span class="s1">self.left = </span><span class="s2">None</span>
        <span class="s1">self.right = </span><span class="s2">None</span>
        <span class="s1">self.color = </span><span class="s3">1</span>


<span class="s2">class </span><span class="s1">RedBlackTree():</span>
    <span class="s2">def </span><span class="s1">__init__(self):</span>
        <span class="s1">self.TNULL = Node(</span><span class="s3">0</span><span class="s1">)</span>
        <span class="s1">self.TNULL.color = </span><span class="s3">0</span>
        <span class="s1">self.TNULL.left = </span><span class="s2">None</span>
        <span class="s1">self.TNULL.right = </span><span class="s2">None</span>
        <span class="s1">self.root = self.TNULL</span>

    <span class="s0"># Preorder</span>
    <span class="s2">def </span><span class="s1">pre_order_helper(self</span><span class="s2">, </span><span class="s1">node):</span>
        <span class="s2">if </span><span class="s1">node != TNULL:</span>
            <span class="s1">sys.stdout.write(node.item + </span><span class="s4">&quot; &quot;</span><span class="s1">)</span>
            <span class="s1">self.pre_order_helper(node.left)</span>
            <span class="s1">self.pre_order_helper(node.right)</span>

    <span class="s0"># Inorder</span>
    <span class="s2">def </span><span class="s1">in_order_helper(self</span><span class="s2">, </span><span class="s1">node):</span>
        <span class="s2">if </span><span class="s1">node != TNULL:</span>
            <span class="s1">self.in_order_helper(node.left)</span>
            <span class="s1">sys.stdout.write(node.item + </span><span class="s4">&quot; &quot;</span><span class="s1">)</span>
            <span class="s1">self.in_order_helper(node.right)</span>

    <span class="s0"># Postorder</span>
    <span class="s2">def </span><span class="s1">post_order_helper(self</span><span class="s2">, </span><span class="s1">node):</span>
        <span class="s2">if </span><span class="s1">node != TNULL:</span>
            <span class="s1">self.post_order_helper(node.left)</span>
            <span class="s1">self.post_order_helper(node.right)</span>
            <span class="s1">sys.stdout.write(node.item + </span><span class="s4">&quot; &quot;</span><span class="s1">)</span>

    <span class="s0"># Search the tree</span>
    <span class="s2">def </span><span class="s1">search_tree_helper(self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">, </span><span class="s1">key):</span>
        <span class="s2">if </span><span class="s1">node == TNULL </span><span class="s2">or </span><span class="s1">key == node.item:</span>
            <span class="s2">return </span><span class="s1">node</span>

        <span class="s2">if </span><span class="s1">key &lt; node.item:</span>
            <span class="s2">return </span><span class="s1">self.search_tree_helper(node.left</span><span class="s2">, </span><span class="s1">key)</span>
        <span class="s2">return </span><span class="s1">self.search_tree_helper(node.right</span><span class="s2">, </span><span class="s1">key)</span>

    <span class="s0"># Balancing the tree after deletion</span>
    <span class="s2">def </span><span class="s1">delete_fix(self</span><span class="s2">, </span><span class="s1">x):</span>
        <span class="s2">while </span><span class="s1">x != self.root </span><span class="s2">and </span><span class="s1">x.color == </span><span class="s3">0</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">x == x.parent.left:</span>
                <span class="s1">s = x.parent.right</span>
                <span class="s2">if </span><span class="s1">s.color == </span><span class="s3">1</span><span class="s1">:</span>
                    <span class="s1">s.color = </span><span class="s3">0</span>
                    <span class="s1">x.parent.color = </span><span class="s3">1</span>
                    <span class="s1">self.left_rotate(x.parent)</span>
                    <span class="s1">s = x.parent.right</span>

                <span class="s2">if </span><span class="s1">s.left.color == </span><span class="s3">0 </span><span class="s2">and </span><span class="s1">s.right.color == </span><span class="s3">0</span><span class="s1">:</span>
                    <span class="s1">s.color = </span><span class="s3">1</span>
                    <span class="s1">x = x.parent</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s2">if </span><span class="s1">s.right.color == </span><span class="s3">0</span><span class="s1">:</span>
                        <span class="s1">s.left.color = </span><span class="s3">0</span>
                        <span class="s1">s.color = </span><span class="s3">1</span>
                        <span class="s1">self.right_rotate(s)</span>
                        <span class="s1">s = x.parent.right</span>

                    <span class="s1">s.color = x.parent.color</span>
                    <span class="s1">x.parent.color = </span><span class="s3">0</span>
                    <span class="s1">s.right.color = </span><span class="s3">0</span>
                    <span class="s1">self.left_rotate(x.parent)</span>
                    <span class="s1">x = self.root</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">s = x.parent.left</span>
                <span class="s2">if </span><span class="s1">s.color == </span><span class="s3">1</span><span class="s1">:</span>
                    <span class="s1">s.color = </span><span class="s3">0</span>
                    <span class="s1">x.parent.color = </span><span class="s3">1</span>
                    <span class="s1">self.right_rotate(x.parent)</span>
                    <span class="s1">s = x.parent.left</span>

                <span class="s2">if </span><span class="s1">s.right.color == </span><span class="s3">0 </span><span class="s2">and </span><span class="s1">s.right.color == </span><span class="s3">0</span><span class="s1">:</span>
                    <span class="s1">s.color = </span><span class="s3">1</span>
                    <span class="s1">x = x.parent</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s2">if </span><span class="s1">s.left.color == </span><span class="s3">0</span><span class="s1">:</span>
                        <span class="s1">s.right.color = </span><span class="s3">0</span>
                        <span class="s1">s.color = </span><span class="s3">1</span>
                        <span class="s1">self.left_rotate(s)</span>
                        <span class="s1">s = x.parent.left</span>

                    <span class="s1">s.color = x.parent.color</span>
                    <span class="s1">x.parent.color = </span><span class="s3">0</span>
                    <span class="s1">s.left.color = </span><span class="s3">0</span>
                    <span class="s1">self.right_rotate(x.parent)</span>
                    <span class="s1">x = self.root</span>
        <span class="s1">x.color = </span><span class="s3">0</span>

    <span class="s2">def </span><span class="s1">__rb_transplant(self</span><span class="s2">, </span><span class="s1">u</span><span class="s2">, </span><span class="s1">v):</span>
        <span class="s2">if </span><span class="s1">u.parent == </span><span class="s2">None</span><span class="s1">:</span>
            <span class="s1">self.root = v</span>
        <span class="s2">elif </span><span class="s1">u == u.parent.left:</span>
            <span class="s1">u.parent.left = v</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">u.parent.right = v</span>
        <span class="s1">v.parent = u.parent</span>

    <span class="s0"># Node deletion</span>
    <span class="s2">def </span><span class="s1">delete_node_helper(self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">, </span><span class="s1">key):</span>
        <span class="s1">z = self.TNULL</span>
        <span class="s2">while </span><span class="s1">node != self.TNULL:</span>
            <span class="s2">if </span><span class="s1">node.item == key:</span>
                <span class="s1">z = node</span>

            <span class="s2">if </span><span class="s1">node.item &lt;= key:</span>
                <span class="s1">node = node.right</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">node = node.left</span>

        <span class="s2">if </span><span class="s1">z == self.TNULL:</span>
            <span class="s1">print(</span><span class="s4">&quot;Cannot find key in the tree&quot;</span><span class="s1">)</span>
            <span class="s2">return</span>

        <span class="s1">y = z</span>
        <span class="s1">y_original_color = y.color</span>
        <span class="s2">if </span><span class="s1">z.left == self.TNULL:</span>
            <span class="s1">x = z.right</span>
            <span class="s1">self.__rb_transplant(z</span><span class="s2">, </span><span class="s1">z.right)</span>
        <span class="s2">elif </span><span class="s1">(z.right == self.TNULL):</span>
            <span class="s1">x = z.left</span>
            <span class="s1">self.__rb_transplant(z</span><span class="s2">, </span><span class="s1">z.left)</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">y = self.minimum(z.right)</span>
            <span class="s1">y_original_color = y.color</span>
            <span class="s1">x = y.right</span>
            <span class="s2">if </span><span class="s1">y.parent == z:</span>
                <span class="s1">x.parent = y</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">self.__rb_transplant(y</span><span class="s2">, </span><span class="s1">y.right)</span>
                <span class="s1">y.right = z.right</span>
                <span class="s1">y.right.parent = y</span>

            <span class="s1">self.__rb_transplant(z</span><span class="s2">, </span><span class="s1">y)</span>
            <span class="s1">y.left = z.left</span>
            <span class="s1">y.left.parent = y</span>
            <span class="s1">y.color = z.color</span>
        <span class="s2">if </span><span class="s1">y_original_color == </span><span class="s3">0</span><span class="s1">:</span>
            <span class="s1">self.delete_fix(x)</span>

    <span class="s0"># Balance the tree after insertion</span>
    <span class="s2">def </span><span class="s1">fix_insert(self</span><span class="s2">, </span><span class="s1">k):</span>
        <span class="s2">while </span><span class="s1">k.parent.color == </span><span class="s3">1</span><span class="s1">:</span>
            <span class="s2">if </span><span class="s1">k.parent == k.parent.parent.right:</span>
                <span class="s1">u = k.parent.parent.left</span>
                <span class="s2">if </span><span class="s1">u.color == </span><span class="s3">1</span><span class="s1">:</span>
                    <span class="s1">u.color = </span><span class="s3">0</span>
                    <span class="s1">k.parent.color = </span><span class="s3">0</span>
                    <span class="s1">k.parent.parent.color = </span><span class="s3">1</span>
                    <span class="s1">k = k.parent.parent</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s2">if </span><span class="s1">k == k.parent.left:</span>
                        <span class="s1">k = k.parent</span>
                        <span class="s1">self.right_rotate(k)</span>
                    <span class="s1">k.parent.color = </span><span class="s3">0</span>
                    <span class="s1">k.parent.parent.color = </span><span class="s3">1</span>
                    <span class="s1">self.left_rotate(k.parent.parent)</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">u = k.parent.parent.right</span>

                <span class="s2">if </span><span class="s1">u.color == </span><span class="s3">1</span><span class="s1">:</span>
                    <span class="s1">u.color = </span><span class="s3">0</span>
                    <span class="s1">k.parent.color = </span><span class="s3">0</span>
                    <span class="s1">k.parent.parent.color = </span><span class="s3">1</span>
                    <span class="s1">k = k.parent.parent</span>
                <span class="s2">else</span><span class="s1">:</span>
                    <span class="s2">if </span><span class="s1">k == k.parent.right:</span>
                        <span class="s1">k = k.parent</span>
                        <span class="s1">self.left_rotate(k)</span>
                    <span class="s1">k.parent.color = </span><span class="s3">0</span>
                    <span class="s1">k.parent.parent.color = </span><span class="s3">1</span>
                    <span class="s1">self.right_rotate(k.parent.parent)</span>
            <span class="s2">if </span><span class="s1">k == self.root:</span>
                <span class="s2">break</span>
        <span class="s1">self.root.color = </span><span class="s3">0</span>

    <span class="s0"># Printing the tree</span>
    <span class="s2">def </span><span class="s1">__print_helper(self</span><span class="s2">, </span><span class="s1">node</span><span class="s2">, </span><span class="s1">indent</span><span class="s2">, </span><span class="s1">last):</span>
        <span class="s2">if </span><span class="s1">node != self.TNULL:</span>
            <span class="s1">sys.stdout.write(indent)</span>
            <span class="s2">if </span><span class="s1">last:</span>
                <span class="s1">sys.stdout.write(</span><span class="s4">&quot;R----&quot;</span><span class="s1">)</span>
                <span class="s1">indent += </span><span class="s4">&quot;     &quot;</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">sys.stdout.write(</span><span class="s4">&quot;L----&quot;</span><span class="s1">)</span>
                <span class="s1">indent += </span><span class="s4">&quot;|    &quot;</span>

            <span class="s1">s_color = </span><span class="s4">&quot;RED&quot; </span><span class="s2">if </span><span class="s1">node.color == </span><span class="s3">1 </span><span class="s2">else </span><span class="s4">&quot;BLACK&quot;</span>
            <span class="s1">print(str(node.item) + </span><span class="s4">&quot;(&quot; </span><span class="s1">+ s_color + </span><span class="s4">&quot;)&quot;</span><span class="s1">)</span>
            <span class="s1">self.__print_helper(node.left</span><span class="s2">, </span><span class="s1">indent</span><span class="s2">, False</span><span class="s1">)</span>
            <span class="s1">self.__print_helper(node.right</span><span class="s2">, </span><span class="s1">indent</span><span class="s2">, True</span><span class="s1">)</span>

    <span class="s2">def </span><span class="s1">preorder(self):</span>
        <span class="s1">self.pre_order_helper(self.root)</span>

    <span class="s2">def </span><span class="s1">inorder(self):</span>
        <span class="s1">self.in_order_helper(self.root)</span>

    <span class="s2">def </span><span class="s1">postorder(self):</span>
        <span class="s1">self.post_order_helper(self.root)</span>

    <span class="s2">def </span><span class="s1">searchTree(self</span><span class="s2">, </span><span class="s1">k):</span>
        <span class="s2">return </span><span class="s1">self.search_tree_helper(self.root</span><span class="s2">, </span><span class="s1">k)</span>

    <span class="s2">def </span><span class="s1">minimum(self</span><span class="s2">, </span><span class="s1">node):</span>
        <span class="s2">while </span><span class="s1">node.left != self.TNULL:</span>
            <span class="s1">node = node.left</span>
        <span class="s2">return </span><span class="s1">node</span>

    <span class="s2">def </span><span class="s1">maximum(self</span><span class="s2">, </span><span class="s1">node):</span>
        <span class="s2">while </span><span class="s1">node.right != self.TNULL:</span>
            <span class="s1">node = node.right</span>
        <span class="s2">return </span><span class="s1">node</span>

    <span class="s2">def </span><span class="s1">successor(self</span><span class="s2">, </span><span class="s1">x):</span>
        <span class="s2">if </span><span class="s1">x.right != self.TNULL:</span>
            <span class="s2">return </span><span class="s1">self.minimum(x.right)</span>

        <span class="s1">y = x.parent</span>
        <span class="s2">while </span><span class="s1">y != self.TNULL </span><span class="s2">and </span><span class="s1">x == y.right:</span>
            <span class="s1">x = y</span>
            <span class="s1">y = y.parent</span>
        <span class="s2">return </span><span class="s1">y</span>

    <span class="s2">def </span><span class="s1">predecessor(self</span><span class="s2">,  </span><span class="s1">x):</span>
        <span class="s2">if </span><span class="s1">(x.left != self.TNULL):</span>
            <span class="s2">return </span><span class="s1">self.maximum(x.left)</span>

        <span class="s1">y = x.parent</span>
        <span class="s2">while </span><span class="s1">y != self.TNULL </span><span class="s2">and </span><span class="s1">x == y.left:</span>
            <span class="s1">x = y</span>
            <span class="s1">y = y.parent</span>

        <span class="s2">return </span><span class="s1">y</span>

    <span class="s2">def </span><span class="s1">left_rotate(self</span><span class="s2">, </span><span class="s1">x):</span>
        <span class="s1">y = x.right</span>
        <span class="s1">x.right = y.left</span>
        <span class="s2">if </span><span class="s1">y.left != self.TNULL:</span>
            <span class="s1">y.left.parent = x</span>

        <span class="s1">y.parent = x.parent</span>
        <span class="s2">if </span><span class="s1">x.parent == </span><span class="s2">None</span><span class="s1">:</span>
            <span class="s1">self.root = y</span>
        <span class="s2">elif </span><span class="s1">x == x.parent.left:</span>
            <span class="s1">x.parent.left = y</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">x.parent.right = y</span>
        <span class="s1">y.left = x</span>
        <span class="s1">x.parent = y</span>

    <span class="s2">def </span><span class="s1">right_rotate(self</span><span class="s2">, </span><span class="s1">x):</span>
        <span class="s1">y = x.left</span>
        <span class="s1">x.left = y.right</span>
        <span class="s2">if </span><span class="s1">y.right != self.TNULL:</span>
            <span class="s1">y.right.parent = x</span>

        <span class="s1">y.parent = x.parent</span>
        <span class="s2">if </span><span class="s1">x.parent == </span><span class="s2">None</span><span class="s1">:</span>
            <span class="s1">self.root = y</span>
        <span class="s2">elif </span><span class="s1">x == x.parent.right:</span>
            <span class="s1">x.parent.right = y</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">x.parent.left = y</span>
        <span class="s1">y.right = x</span>
        <span class="s1">x.parent = y</span>

    <span class="s2">def </span><span class="s1">insert(self</span><span class="s2">, </span><span class="s1">key):</span>
        <span class="s1">node = Node(key)</span>
        <span class="s1">node.parent = </span><span class="s2">None</span>
        <span class="s1">node.item = key</span>
        <span class="s1">node.left = self.TNULL</span>
        <span class="s1">node.right = self.TNULL</span>
        <span class="s1">node.color = </span><span class="s3">1</span>

        <span class="s1">y = </span><span class="s2">None</span>
        <span class="s1">x = self.root</span>

        <span class="s2">while </span><span class="s1">x != self.TNULL:</span>
            <span class="s1">y = x</span>
            <span class="s2">if </span><span class="s1">node.item &lt; x.item:</span>
                <span class="s1">x = x.left</span>
            <span class="s2">else</span><span class="s1">:</span>
                <span class="s1">x = x.right</span>

        <span class="s1">node.parent = y</span>
        <span class="s2">if </span><span class="s1">y == </span><span class="s2">None</span><span class="s1">:</span>
            <span class="s1">self.root = node</span>
        <span class="s2">elif </span><span class="s1">node.item &lt; y.item:</span>
            <span class="s1">y.left = node</span>
        <span class="s2">else</span><span class="s1">:</span>
            <span class="s1">y.right = node</span>

        <span class="s2">if </span><span class="s1">node.parent == </span><span class="s2">None</span><span class="s1">:</span>
            <span class="s1">node.color = </span><span class="s3">0</span>
            <span class="s2">return</span>

        <span class="s2">if </span><span class="s1">node.parent.parent == </span><span class="s2">None</span><span class="s1">:</span>
            <span class="s2">return</span>

        <span class="s1">self.fix_insert(node)</span>

    <span class="s2">def </span><span class="s1">get_root(self):</span>
        <span class="s2">return </span><span class="s1">self.root</span>

    <span class="s2">def </span><span class="s1">delete_node(self</span><span class="s2">, </span><span class="s1">item):</span>
        <span class="s1">self.delete_node_helper(self.root</span><span class="s2">, </span><span class="s1">item)</span>

    <span class="s2">def </span><span class="s1">print_tree(self):</span>
        <span class="s1">self.__print_helper(self.root</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">, True</span><span class="s1">)</span>


<span class="s2">if </span><span class="s1">__name__ == </span><span class="s4">&quot;__main__&quot;</span><span class="s1">:</span>
    <span class="s1">bst = RedBlackTree()</span>

    <span class="s1">bst.insert(</span><span class="s3">55</span><span class="s1">)</span>
    <span class="s1">bst.insert(</span><span class="s3">40</span><span class="s1">)</span>
    <span class="s1">bst.insert(</span><span class="s3">65</span><span class="s1">)</span>
    <span class="s1">bst.insert(</span><span class="s3">60</span><span class="s1">)</span>
    <span class="s1">bst.insert(</span><span class="s3">75</span><span class="s1">)</span>
    <span class="s1">bst.insert(</span><span class="s3">57</span><span class="s1">)</span>

    <span class="s1">bst.print_tree()</span>

    <span class="s1">print(</span><span class="s4">&quot;</span><span class="s2">\n</span><span class="s4">After deleting an element&quot;</span><span class="s1">)</span>
    <span class="s1">bst.delete_node(</span><span class="s3">40</span><span class="s1">)</span>
    <span class="s1">bst.print_tree()</span></pre>
</body>
</html>